<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
		<title>mainpage</title>
		<style> @import url("../css/bottom.css"); </style>
		<link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/2.3.0/weui.min.css" />
		<style>
			.weui-cells {
				margin: 0 0 0 0;
			}
		</style>
	</head>
	<body>
		<div id="app">
			<div class="top">
				<div class="top_pic">
					<img v-bind:src="portraitSrc" style="border-radius: 50%; width: 30px; height: 30px;">
				</div>
				<div class="top_name">
					<div style="display: table-cell; vertical-align: middle;">消 息</div>
				</div>
				<div class="top_more">
					<img src="../img/chat/message_more_w.png" style="width: 40%;">
				</div>
			</div>
			<div class="middle">
				<div class="weui-cells" @click="">
					<div class="weui-cell weui-cell_active">
						<div class="weui-cell__hd" style="position: relative; margin-right: 10px;">
							<img src="../img/chat/chat_show.png" style="width: 50px; display: block;" />
							<span class="weui-badge" style="position: absolute; top: -0.4em; right: -0.4em;">8</span>
						</div>
						<div class="weui-cell__bd">
							<p>联系人名称</p>
							<p style="font-size: 13px; color: #888;">摘要信息</p>
						</div>
						<div class="weui-cell__ft">时间</div>
					</div>
				</div>
			</div>

			<div class="bottom_bar">
				<div class="bottom_bar1" v-bind:class="{whiten:ifBottom1}" @click="isBottomShow1">
					<img class="bottom_icon" src="../img/icon/message.png">

				</div>
				<div class="bottom_bar2" v-bind:class="{whiten:ifBottom2}" @click="isBottomShow2">
					<img class="bottom_icon" src="../img/icon/mailList.png">
				</div>
				<div class="bottom_bar3" v-bind:class="{whiten:ifBottom3}" @click="isBottomShow3">
					<img class="bottom_icon" src="../img/icon/mine.png">
				</div>
			</div>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script type="text/javascript">
			var app = new Vue({
				el: "#app",
				data: {
					ifBottom1: true,
					ifBottom2: false,
					ifBottom3: false,
					username: '',
					portraitSrc: '',
					messagelist: [],
					
				},
				mounted() {
					this.username = document.cookie.split('=')[1];
					console.log(this.username + " login")
					if (localStorage.getItem("username") == null) {
						axios.get('http://129.211.62.153:8080/user/searchByLoginID/' + this.username).then((res) => {
							console.log(res)
							var sign = res.data.intro;
							var email = res.data.email;
							if (sign == null)
								sign = ''
							console.log(sign)
							if (email == null)
								email = ''
							localStorage.setItem("username", this.username);
							localStorage.setItem("nickname", res.data.nickname);
							localStorage.setItem("uid", res.data.uid);
							localStorage.setItem("sex", res.data.sex);
							localStorage.setItem("age", res.data.age);
							localStorage.setItem("sign", sign);
							localStorage.setItem("email", email);
							//头像获取
							var picsrc = "http://129.211.62.153:8080/image/" + res.data.uid + "/head.jpg";
							localStorage.setItem("pic", picsrc);
							this.portraitSrc = picsrc
							loadPortrait(this.uid, picsrc, "Portrait")
						})
					}
					else {
						this.portraitSrc = localStorage.getItem("pic")
					}
				},
				methods: {
					isBottomShow1: function() {
						this.ifBottom1 = true;
						this.ifBottom2 = false;
						this.ifBottom3 = false;
					},
					isBottomShow2: function() {
						window.location.href = './list.html';
					},
					isBottomShow3: function() {
						window.location.href = './me.html';
					},
					toFriends: function(uid) {
						localStorage.setItem("nf") = uid;
						window.location.href = './friend.html';
					},
					toChatroom: function(rid) {
						localStorage.setItem("nr") = rid;
						window.location.href = './chatroom.html';
					}
				}
			})
		</script>

	</body>
</html>
